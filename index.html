<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trashmon Go</title>
    <link rel="stylesheet" href="styles.css">

    <style>
        /* Styles existants */
        #role-popup {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        #role-popup-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 300px;
        }
        #role-popup select, #role-popup input, #role-popup button {
            padding: 10px; margin-top: 10px; width: 100%; font-size: 16px;
        }
        #admin-password-container { display: none; }

        /* --- NOUVEAUX STYLES DU COMPTEUR LIVE --- */
        .live-counter-container {
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 500px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .live-badge {
            display: inline-block;
            background: #ff4757;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .counter-total {
            font-size: 24px;
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .live-event {
            font-size: 14px;
            color: #555;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            border-radius: 4px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.5s ease;
        }

        .event-time {
            font-size: 11px;
            color: #999;
            margin-bottom: 4px;
        }

        .event-msg b {
            color: #4CAF50;
        }
    </style>
</head>

<body>

<header class="banner">
    <h1 class="trashmon">Trashmon Go</h1>
    <p>Attrape-les tous... avant qu'ils n'atteignent la mer !</p>
    <nav>
        <a href="index.html">Accueil</a> |
        <a href="map.html">Carte</a> |
        <a href="capture.html">Galerie</a> |
        <a href="collection.html">Collection</a> |
        <a href="profile.html">Profil</a>
    </nav>
    <div id="user-role-display" style="margin-top:6px;font-weight:bold;"></div>
</header>

<div class="hero">
    <img src="ressources/imageaccueil.png" class="hero-image">
</div>

<main>
    <section class="cta">
        <button id="start-button">üå± Commencer √† nettoyer</button>
        <p>Rejoignez la communaut√© pour sauver le littoral !</p>
    </section>

    <section class="live-counter-container">
        <div class="live-badge">‚óè Live Activity</div>
        <div class="counter-total">
            <span id="total-trashmons">12 482</span> Trashmons collect√©s
        </div>
        <div class="live-event" id="live-event-box">
            <div class="event-time" id="event-date">Chargement des donn√©es...</div>
            <div class="event-msg" id="event-text">Initialisation du flux communautaire...</div>
        </div>
    </section>

    <section class="features">
        <h2>Fonctionnalit√©s</h2>
        <ul>
            <li>üßπ Collectez des Trashmons en nettoyant</li>
            <li>üåç Participez √† des √©v√©nements collectifs</li>
            <li>üìä Visualisez l'impact environnemental</li>
        </ul>
    </section>
</main>

<footer class="footer-banner">
    <p>&copy; 2026 Trashmon Go - Tous droits r√©serv√©s</p>
</footer>

<div id="role-popup" style="display:none;">
    <div id="role-popup-content">
        <h2>Choisissez votre r√¥le</h2>
        <select id="role-select">
            <option value="">-- S√©lectionnez --</option>
            <option value="admin">Admin</option>
            <option value="user">Utilisateur</option>
        </select>
        <div id="admin-password-container">
            <input type="password" id="admin-password" placeholder="Mot de passe admin">
        </div>
        <button id="role-confirm">Confirmer</button>
    </div>
</div>

<script>
/* ==========================================
    üî• LOGIQUE DU COMPTEUR LIVE
========================================== */
const trashmonTypes = [
    "Canette Grincheuse",
    "M√©got Ninja",
    "Carton H√©riss√©",
    "Bouteille Furieuse",
    "Verre Coupant"
];

let totalTrashmons = 12482; // Nombre de d√©part

function updateLiveFeed() {
    // 1. Incr√©menter le total al√©atoirement
    const added = Math.floor(Math.random() * 3) + 1;
    totalTrashmons += added;
    document.getElementById('total-trashmons').innerText = totalTrashmons.toLocaleString();

    // 2. G√©n√©rer une date/heure
    const maintenant = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
    const dateLabel = maintenant.toLocaleDateString('fr-FR', options);

    // 3. Choisir un Trashmon et un nombre de personnes
    const type = trashmonTypes[Math.floor(Math.random() * trashmonTypes.length)];
    const nbPers = Math.floor(Math.random() * 5) + 1;

    // 4. Mettre √† jour l'affichage avec une petite animation
    const eventBox = document.getElementById('live-event-box');
    eventBox.style.opacity = "0";

    setTimeout(() => {
        document.getElementById('event-date').innerText = dateLabel;
        document.getElementById('event-text').innerHTML = `<b>${nbPers} personne(s)</b> ont collect√© <b>${added} ${type}</b>`;
        eventBox.style.opacity = "1";
    }, 500);

    // 5. Relancer la fonction al√©atoirement entre 4 et 8 secondes
    setTimeout(updateLiveFeed, (Math.random() * 4000) + 4000);
}

// Lancer le flux au chargement
updateLiveFeed();


/* ==========================
    üç™ GESTION DES COOKIES (Existant)
========================== */
function setCookie(name, value, days=365){
    const d = new Date();
    d.setTime(d.getTime() + (days*24*60*60*1000));
    document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/;SameSite=Lax";
}
function getCookie(name){
    const cname = name + "=";
    const decoded = decodeURIComponent(document.cookie);
    const ca = decoded.split(';');
    for(let c of ca){
        c = c.trim();
        if(c.indexOf(cname) === 0) return c.substring(cname.length);
    }
    return "";
}

const rolePopup = document.getElementById("role-popup");
const roleDisplay = document.getElementById("user-role-display");
const roleSelect = document.getElementById("role-select");
const passwordBox = document.getElementById("admin-password-container");

const savedRole = getCookie("userRole");
if(savedRole){
    roleDisplay.innerText = "R√¥le : " + (savedRole === "admin" ? "Admin" : "Utilisateur");
}else{
    rolePopup.style.display = "flex";
}

roleSelect.addEventListener("change", () => {
    passwordBox.style.display = roleSelect.value === "admin" ? "block" : "none";
});

document.getElementById("role-confirm").addEventListener("click", () => {
    const role = roleSelect.value;
    if (!role) { alert("Veuillez choisir un r√¥le"); return; }

    if (role === "admin") {
        const pwd = document.getElementById("admin-password").value;
        if (pwd === "trashmon123") {
            setCookie("userRole","admin");
            roleDisplay.innerText = "R√¥le : Admin";
        } else {
            alert("Mot de passe incorrect ‚Üí Utilisateur standard");
            setCookie("userRole","user");
            roleDisplay.innerText = "R√¥le : Utilisateur";
        }
    } else {
        setCookie("userRole","user");
        roleDisplay.innerText = "R√¥le : Utilisateur";
    }
    rolePopup.style.display = "none";
});

document.getElementById("start-button").onclick = () => {
    window.location.href = "map.html";
};
</script>

</body>
</html>
